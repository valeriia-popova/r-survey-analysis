---
title: "Final project tutorial: GSS 2024"
format: 
  html: 
    embed-resources: true
execute: 
  warning: false 
  message: false
editor: visual
---

## Prerequisite: install required packages

You only need to install these packages once. For your actual final projects, skip this step.

```{r}
#| eval: FALSE 

install.packages("labelled")
install.packages("gtsummary") # optional for step 10
```

## Step 1: load required packages

Remember: you need to load the tidyverse package every time you start a new R project. Other applicable packages depend on the project. For your final projects, load the following libraries:

```{r}
library(tidyverse)
library(labelled)
library(gtsummary) # optional for step 10
```

## Step 2: import the dataset

The dataset should appear in the Environment tab. Set up the proper path to the dataset on your computer.

```{r}
load(url("https://raw.githubusercontent.com/valeriia-popova/political_analysis/main/gss2024.RData"))
```

## Step 3: identify your variables

To find variables that you will be using in your final project, you need to know their names or labels. You have several ways to get that information.

-   **Option 1**: search in R using the `labelled` package. In the following code, replace "abortion" with a keyword of your interest. Pay attention if the variable has any missing or negative values. Once you've identified all of your variables, take note of their names (e.g. `educ`).

```{r}
look_for(gss2024, "corrupt")
```

-   **Option 2**: use the [GSS Search](https://gssdataexplorer.norc.org/variables/vfilter) tool - it is a fantastic resource to see variables and their distribution. Adjust the year to limit your search to 2024 only. Pay attention if the variable has any missing or negative values. Once you've identified all of your variables, take note of their names (e.g. `educ`).

For example, I've identified the following three variables that I will use in my analysis. Most likely, your final projects will include more than 3 variables.

-   **corruptn** How widespread corruption is in public service in America? (DV)

-   **educ** Highest year of school completed (IV)

-   **sex** Respondent's sex (CV)

If, during your work on your project, you need to refresh your memory of what your variable is about, type its name after `?` in R - the Help window will open with all available information about the variable. It's a great way to see the variable's categories, wording of the questions, etc.

```{r}
#| eval: FALSE 
?educ
```

## Step 4: create a smaller, clean dataset

This dataset will contain only your variables of interest from Step 3. You will work with this dataset from now on, not the main complete dataset. Give your new dataset an intuitive, simple name (mine is named `test_project`; yours will be different).

You will also need to rename your variables to something intuitive. In the example below, original variable names and the new names are for demonstration only. Yours will be different.

Exception: the line of code `weight = wtssps` must be included exactly as written. It is responsible for weighting the dataset.

```{r}
test_project <- gss2024  |> 
  select(
    corruptn, educ, sex, wtssps)  |> 
  rename(
    corruption = corruptn,
    education = educ,
    sex = sex, 
    weight = wtssps
  )
```

## Step 5: check for missing and abnormal values

Before you move on to analysis, you need to check for missing and abnormal values. If you forget to exclude missing values from analysis, your charts will appear with useless categories.

Replace `corruption` in the code below with the name of your variable. Repeat the same step for all the variables one by one. Take note which abnormal and missing values you see.

Note: sometimes in Quarto, the labels aren't printed. When typing in script, you can see the labels in the console.

For categorical variables:

```{r}

test_project |> 
  count(corruption)
```

For continuous variables (two options):

```{r}
summary(test_project$education)

ggplot(test_project, aes(x = education)) + 
  geom_histogram()
```

## Step 6: recode the variables if needed

In GSS, most variables appear as numerical (double). If you know your variable is categorical (nominal or ordinal), it is necessary to convert it into a factor in R.

To check the coding of the original variable, type ? before the variable name.

-   **Example**: Convert the `sex` variable into a factor. It helps with interpretation of the regression results.
-   Note that I am "renaming" my new recoded variable using the same name. It will quietly rewrite the old variable.

```{r}
test_project <- test_project |> 
  mutate(sex = as_factor(sex))
```

## Step 7: check that recoding was successful

```{r}
test_project |> 
  count(sex)
```

## Step 8: create a linear model

Replace the example variables below with the names of your variables. Note that DV comes first. Always include the weight variable as is.

Give your model an intuitive name (I am using generic model_test_project; yours will be different).

```{r}
model_test_project <- lm(corruption ~ education + sex, 
                         data = test_project, 
                         weights = weight)
```

## Step 9: examine the results of the linear model

```{r}
summary(model_test_project)
```

You can stop at this point. If you want to format this regression table in a word processor or Excel, just copy it and paste it in the program where you are writing your final project. If you want to create a pretty table in R and save it as is, continue below.

## Step 10 (optional): create a custom table

```{r}
model_test_project |> 
  tbl_regression(
    label = list(
      education ~ "Years of education",
      sex ~ "Sex"
    )
  ) |> 
  add_significance_stars(hide_ci = FALSE, hide_p = FALSE) |> 
  bold_labels() |> 
  italicize_levels() |> 
  modify_caption("**Effect of Education and Sex on Corruption Perception (GSS 2024)**") |>
  modify_footnote(
    estimate ~ "\\*p<0.05; \\**p<0.01; \\***p<0.001"
  )
```
